<!DOCTYPE html>
<html lang="{{ config.default_language }}" prefix="og: https://ogp.me/ns#">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="color-scheme" content="dark light">

    <!-- Primary Meta Tags -->
    {% block title %}
    <title>{% if page.title %}{{ page.title }} | {% elif section.title %}{{ section.title }} | {% endif %}{{ config.title }}</title>
    {% endblock title %}

    {% set description = config.description %}
    {% if page.description %}
        {% set description = page.description %}
    {% elif section.description %}
        {% set description = section.description %}
    {% endif %}

    <meta name="description" content="{{ description }}" />
    {% if page.taxonomies.tags %}
    <meta name="keywords" content="{{ page.taxonomies.tags | join(sep=', ') }}">
    {% elif config.extra.keywords %}
    <meta name="keywords" content="{{ config.extra.keywords }}">
    {% endif %}
    <meta name="author" content="{{ config.extra.author }}">

    <!-- Search Engine Meta Tags -->
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">

    <!-- Canonical URL -->
    {% if current_url %}
    <link rel="canonical" href="{{ current_url | safe }}">
    {% else %}
    <link rel="canonical" href="{{ config.base_url | safe }}">
    {% endif %}

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="{% if page %}article{% else %}website{% endif %}">
    <meta property="og:url" content="{{ current_url | default(value=config.base_url) | safe }}">
    <meta property="og:site_name" content="{{ config.extra.site_name }}" />
    <meta property="og:title" content="{% if page.title %}{{ page.title }} | {% elif section.title %}{{ section.title }} | {% endif %}{{ config.title }}"/>
    <meta property="og:description" content="{{ description }}" />
    {% if page.extra.image %}
    <meta property="og:image" content="{{ get_url(path=page.extra.image) | safe }}">
    <meta property="og:image:alt" content="{{ page.title | default(value=config.title) }}">
    {% elif config.extra.og_image %}
    <meta property="og:image" content="{{ get_url(path=config.extra.og_image) | safe }}">
    <meta property="og:image:alt" content="{{ config.title }} - {{ config.description }}">
    {% endif %}
    <meta property="og:locale" content="{{ config.default_language | replace(from='-', to='_') }}">
    {% if page %}
    <meta property="article:author" content="{{ page.extra.author | default(value=config.extra.author) }}" />
    {% if page.date %}
    <meta property="article:published_time" content="{{ page.date | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00" />
    {% endif %}
    {% if page.updated %}
    <meta property="article:modified_time" content="{{ page.updated | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00">
    {% endif %}
    {% if page.taxonomies.tags %}
    {% for tag in page.taxonomies.tags %}
    <meta property="article:tag" content="{{ tag }}">
    {% endfor %}
    {% endif %}
    {% endif %}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:url" content="{{ current_url | default(value=config.base_url) | safe }}">
    <meta name="twitter:title" content="{% if page.title %}{{ page.title }} | {% elif section.title %}{{ section.title }} | {% endif %}{{ config.title }}" />
    <meta name="twitter:description" content="{{ description }}"/>
    {% if page.extra.image %}
    <meta name="twitter:image" content="{{ get_url(path=page.extra.image) | safe }}">
    <meta name="twitter:image:alt" content="{{ page.title | default(value=config.title) }}">
    {% elif config.extra.og_image %}
    <meta name="twitter:image" content="{{ get_url(path=config.extra.og_image) | safe }}">
    <meta name="twitter:image:alt" content="{{ config.title }}">
    {% endif %}
    {% if config.extra.social.twitter %}
    <meta name="twitter:site" content="@raskelll">
    <meta name="twitter:creator" content="@raskelll">
    {% endif %}

    <!-- Schema.org microdata -->
    <meta itemprop="name" content="{% if page.title %}{{ page.title }} | {% elif section.title %}{{ section.title }} | {% endif %}{{ config.title }}" />
    <meta itemprop="description" content="{{ description }}"/>
    <meta name="application-name" content="{{ config.title }}" />
    <meta name="theme-color" content="#cba6f7" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#8839ef" media="(prefers-color-scheme: light)">

    <!-- Favicon -->
    <link rel="icon" href="{{ get_url(path='favicon.ico') | safe }}" sizes="48x48">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ get_url(path='favicon-32x32.png') | safe }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ get_url(path='icon-192.png') | safe }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ get_url(path='apple-touch-icon.png') | safe }}">
    <link rel="manifest" href="{{ get_url(path='site.webmanifest') | safe }}">

    <!-- Feeds -->
    {% if config.generate_feeds %}
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for {{ config.title }}" href="{{ get_url(path='rss.xml') | safe }}">
    {% endif %}

    <!-- Stylesheet -->
    <link rel="stylesheet" href="{{ get_url(path='style.css') | safe }}">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

    <!-- Theme detection script - runs before paint to prevent FOUC -->
    <script>
        (function() {
            const colorSchemeKey = 'ThemeColorScheme';
            const defaultScheme = '{{ config.extra.default_color_scheme | default(value="auto") }}';
            {% if config.extra.color_scheme_toggle %}
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, defaultScheme);
            }
            {% else %}
            localStorage.setItem(colorSchemeKey, defaultScheme);
            {% endif %}
        })();
    </script>

    <script>
        (function() {
            const colorSchemeKey = 'ThemeColorScheme';
            const colorSchemeItem = localStorage.getItem(colorSchemeKey);
            const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

            // Set theme setting (light/dark/auto)
            document.documentElement.dataset.themeSetting = colorSchemeItem || 'auto';

            // Set effective theme (light/dark)
            if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
                document.documentElement.dataset.userColorScheme = 'dark';
            } else {
                document.documentElement.dataset.userColorScheme = 'light';
            }
        })();
    </script>

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@graph": [
            {
                "@type": "WebSite",
                "@id": "{{ config.base_url | safe }}/#website",
                "url": "{{ config.base_url | safe }}",
                "name": "{{ config.title }}",
                "description": "{{ config.description }}",
                "publisher": {
                    "@id": "{{ config.base_url | safe }}/#person"
                },
                "inLanguage": "{{ config.default_language }}"
            },
            {
                "@type": "Person",
                "@id": "{{ config.base_url | safe }}/#person",
                "name": "{{ config.extra.author }}",
                "url": "{{ config.base_url | safe }}"
                {% if config.extra.social.github %},"sameAs": [
                    "{{ config.extra.social.github }}"
                    {% if config.extra.social.linkedin %},"{{ config.extra.social.linkedin }}"{% endif %}
                    {% if config.extra.social.twitter %},"{{ config.extra.social.twitter }}"{% endif %}
                ]{% endif %}
            },
            {
                "@type": "WebPage",
                "@id": "{{ current_url | default(value=config.base_url) | safe }}/#webpage",
                "url": "{{ current_url | default(value=config.base_url) | safe }}",
                "name": "{% if page.title %}{{ page.title }}{% elif section.title %}{{ section.title }}{% else %}{{ config.title }}{% endif %}",
                "description": "{{ description }}",
                "isPartOf": {
                    "@id": "{{ config.base_url | safe }}/#website"
                },
                "inLanguage": "{{ config.default_language }}"
                {% if page.date %},
                "datePublished": "{{ page.date | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00"
                {% endif %}
                {% if page.updated %},
                "dateModified": "{{ page.updated | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00"
                {% endif %}
            }
            {% if page %},
            {
                "@type": "Article",
                "@id": "{{ current_url | safe }}/#article",
                "headline": "{{ page.title }}",
                "description": "{{ page.description | default(value=config.description) }}",
                "url": "{{ current_url | safe }}",
                "isPartOf": {
                    "@id": "{{ current_url | safe }}/#webpage"
                },
                "mainEntityOfPage": {
                    "@id": "{{ current_url | safe }}/#webpage"
                },
                "inLanguage": "{{ config.default_language }}",
                "author": {
                    "@type": "Person",
                    "@id": "{{ config.base_url | safe }}/#person"
                },
                "publisher": {
                    "@id": "{{ config.base_url | safe }}/#person"
                }
                {% if page.date %},
                "datePublished": "{{ page.date | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00"
                {% endif %}
                {% if page.updated %},
                "dateModified": "{{ page.updated | date(format='%Y-%m-%dT%H:%M:%S') }}+00:00"
                {% endif %}
                {% if page.taxonomies.tags %},
                "keywords": "{{ page.taxonomies.tags | join(sep=', ') }}"
                {% endif %}
                {% if page.word_count %},
                "wordCount": {{ page.word_count }}
                {% endif %}
                {% if page.extra.image %},
                "image": "{{ get_url(path=page.extra.image) | safe }}"
                {% endif %}
            }
            {% endif %}
            {% block jsonld_breadcrumb %}{% endblock %}
        ]
    }
    </script>

    {% block head %}{% endblock %}
</head>

<body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    {% include "partials/header.html" %}

    <main id="main-content" role="main" aria-label="Main content">
        {% block content %}{% endblock %}
    </main>

    {% include "partials/footer.html" %}

    <script src="{{ get_url(path='scroll-to-top.js') | safe }}"></script>
    <script>lucide.createIcons();</script>

    {% if config.build_search_index %}
    <script src="{{ get_url(path='elasticlunr.min.js') | safe }}"></script>
    <script src="{{ get_url(path='search_index.en.js') | safe }}"></script>
    <script src="{{ get_url(path='search.js') | safe }}"></script>
    {% endif %}
</body>
</html>
