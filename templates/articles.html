{% extends "base.html" %} {% block content %}
<header>
    <div class="container">
        <h1>{{ section.title }}</h1>
        <p class="subtitle">{{ section.extra.subtitle }}</p>
    </div>
</header>

<section>
    <div class="container">
        <div class="search-container">
            <input
                id="search-query"
                type="search"
                placeholder="Search articles..."
                autocomplete="off"
            />
            <div class="search-shortcuts">
                <kbd>/</kbd>
                <kbd>âŒ˜K</kbd>
            </div>
        </div>

        <section id="articles-list"></section>
    </div>
</section>

<script>
    // Render articles with yyyy-mm-dd prefix
    const articlesList = document.getElementById('articles-list');
    const articles = [
        {% for page in section.pages %}
        {
            title: {{ page.title | json_encode | safe }},
            permalink: {{ page.permalink | json_encode | safe }},
            date: {{ page.date | json_encode | safe }},
            dateFormatted: {{ page.date | date(format="%Y-%m-%d") | json_encode | safe }},
            description: {{ page.description | default(value="") | json_encode | safe }}
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ];

    function renderArticles(articlesToRender) {
        // Sort by date descending
        const sorted = [...articlesToRender].sort((a, b) => new Date(b.date) - new Date(a.date));

        let html = '<div class="posts">';
        sorted.forEach(article => {
            html += `
                <div class="post" data-title="${article.title.toLowerCase()}" data-date="${article.dateFormatted}" data-description="${article.description.toLowerCase()}">
                    <a href="${article.permalink}">
                        <div class="post-row">
                            <time>${article.dateFormatted}</time>
                            <h3>${article.title}</h3>
                        </div>
                    </a>
                </div>
            `;
        });
        html += '</div>';

        articlesList.innerHTML = html;
    }

    renderArticles(articles);
</script>

<script>
    const searchInput = document.getElementById("search-query");

    // Simple search filtering
    searchInput.addEventListener("input", function () {
        const query = this.value.trim().toLowerCase();
        const posts = articlesList.querySelectorAll(".post");

        if (query.length === 0) {
            // Show all posts
            posts.forEach((post) => (post.style.display = ""));
            return;
        }

        // Filter posts by title, date, or description
        posts.forEach((post) => {
            const title = post.getAttribute("data-title") || "";
            const date = post.getAttribute("data-date") || "";
            const description = post.getAttribute("data-description") || "";

            const searchText = `${title} ${date} ${description}`;

            if (searchText.includes(query)) {
                post.style.display = "";
            } else {
                post.style.display = "none";
            }
        });
    });

    // Keyboard shortcuts
    document.addEventListener("keydown", function (e) {
        // Cmd+K or Ctrl+K
        if ((e.ctrlKey || e.metaKey) && e.key === "k") {
            e.preventDefault();
            searchInput.focus();
            searchInput.select();
        }
        // Forward slash (/) when not in an input
        else if (
            e.key === "/" &&
            !["INPUT", "TEXTAREA"].includes(document.activeElement.tagName)
        ) {
            e.preventDefault();
            searchInput.focus();
        }
        // Escape to clear search
        else if (e.key === "Escape" && document.activeElement === searchInput) {
            searchInput.value = "";
            searchInput.dispatchEvent(new Event("input"));
            searchInput.blur();
        }
    });
</script>
{% endblock content %}
