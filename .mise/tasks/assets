#!/usr/bin/env bash
#MISE description="Process all assets (images, fonts, etc.)"

set -euo pipefail

echo "üèóÔ∏è  Running asset pipeline..."

# Convert images from source to optimized formats
echo ""
echo "1Ô∏è‚É£  Converting images..."
mise run convert-images

# Download fonts if needed
echo ""
echo "2Ô∏è‚É£  Processing fonts..."
if [[ -f ".mise/tasks/download-fonts" ]]; then
    mise run download-fonts
else
    echo "  ‚è≠Ô∏è  No font processing task found, skipping..."
fi

# Create branding assets if needed
echo ""
echo "3Ô∏è‚É£  Processing branding..."
if [[ -f ".mise/tasks/create-branding" ]]; then
    mise run create-branding
else
    echo "  ‚è≠Ô∏è  No branding processing task found, skipping..."
fi

echo ""
echo "‚ú® Asset pipeline complete!"

# Show a summary of processed files
echo ""
echo "üìä Asset Summary:"
echo "  Source images: $(find static/src -type f \( -name "*.png" -o -name "*.jpg" -o -name "*.jpeg" \) | wc -l | tr -d ' ')"
echo "  AVIF images:   $(find static -maxdepth 1 -name "*.avif" | wc -l | tr -d ' ')"
echo ""
echo "üí° Next steps:"
echo "  - Run 'mise run build' to build your site"
echo "  - Run 'mise run serve' to preview locally"
